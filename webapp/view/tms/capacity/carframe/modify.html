<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>车架管理 - TMS</title>
    <link rel="stylesheet" href="/view/frame/layui/css/layui.css" media="all">
    <link rel="stylesheet" href="/view/frame/static/css/global.css?v=1.0">
    <link rel="stylesheet" href="/view/tms/static/css/add.css?v=1.0">
</head>
<body>
    <form class="layui-form" autocomplete="off">
        <fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;">
            <legend>基本信息</legend>
        </fieldset>
        <div class="layui-fluid">
            <div class="layui-row">
                <div class="layui-col-sm4">
                    <div class="layui-form-item layui-form-item--require">
                        <label class="layui-form-label">车架车牌</label>
                        <div class="layui-input-block">
                            <div class="layui-col-sm4">
                                <div class="margin-right10">
                                    <select name="carShort">
                                        <option value="粤">粤</option>
                                        <option value="京">京</option>
                                        <option value="津">津</option>
                                        <option value="沪">沪</option>
                                        <option value="渝">渝</option>
                                        <option value="冀">冀</option>
                                        <option value="豫">豫</option>
                                        <option value="云">云</option>
                                        <option value="辽">辽</option>
                                        <option value="黑">黑</option>
                                        <option value="湘">湘</option>
                                        <option value="皖">皖</option>
                                        <option value="鲁">鲁</option>
                                        <option value="新">新</option>
                                        <option value="苏">苏</option>
                                        <option value="浙">浙</option>
                                        <option value="赣">赣</option>
                                        <option value="鄂">鄂</option>
                                        <option value="桂">桂</option>
                                        <option value="甘">甘</option>
                                        <option value="晋">晋</option>
                                        <option value="蒙">蒙</option>
                                        <option value="陕">陕</option>
                                        <option value="吉">吉</option>
                                        <option value="闽">闽</option>
                                        <option value="贵">贵</option>
                                        <option value="青">青</option>
                                        <option value="藏">藏</option>
                                        <option value="川">川</option>
                                        <option value="宁">宁</option>
                                        <option value="琼">琼</option>
                                    </select>
                                </div>
                            </div>
                            <div class="layui-col-sm4">
                                <div>
                                    <input type="text" name="carNo" id="carNo" placeholder="" maxlength="10" class="layui-input layui-col-sm6" lay-verify="required">
                                </div>
                            </div>
                            <div class="layui-col-sm1 line-space">/</div>
                            <div class="layui-col-sm3">
                                <div>
                                    <select name="carColor" lay-verify="required">
                                        <option value="黄">黄</option>
                                        <option value="黑">黑</option>
                                        <option value="白">白</option>
                                        <option value="蓝">蓝</option>
                                        <option value="绿">绿</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="layui-col-sm4">
                    <div class="layui-form-item ">
                        <label class="layui-form-label">拖车车牌</label>
                        <div class="layui-input-block">
                            <div class="layui-col-sm4">
                                <div class="margin-right10">
                                    <select name="trailerShort">
                                        <option value="粤">粤</option>
                                        <option value="京">京</option>
                                        <option value="津">津</option>
                                        <option value="沪">沪</option>
                                        <option value="渝">渝</option>
                                        <option value="冀">冀</option>
                                        <option value="豫">豫</option>
                                        <option value="云">云</option>
                                        <option value="辽">辽</option>
                                        <option value="黑">黑</option>
                                        <option value="湘">湘</option>
                                        <option value="皖">皖</option>
                                        <option value="鲁">鲁</option>
                                        <option value="新">新</option>
                                        <option value="苏">苏</option>
                                        <option value="浙">浙</option>
                                        <option value="赣">赣</option>
                                        <option value="鄂">鄂</option>
                                        <option value="桂">桂</option>
                                        <option value="甘">甘</option>
                                        <option value="晋">晋</option>
                                        <option value="蒙">蒙</option>
                                        <option value="陕">陕</option>
                                        <option value="吉">吉</option>
                                        <option value="闽">闽</option>
                                        <option value="贵">贵</option>
                                        <option value="青">青</option>
                                        <option value="藏">藏</option>
                                        <option value="川">川</option>
                                        <option value="宁">宁</option>
                                        <option value="琼">琼</option>
                                    </select>
                                </div>
                            </div>
                            <div class="layui-col-sm4">
                                <div>
                                    <input type="text" name="trailerNo" id="trailerNo" placeholder="" maxlength="10" class="layui-input layui-col-sm6">
                                </div>
                            </div>
                            <div class="layui-col-sm1 line-space">/</div>
                            <div class="layui-col-sm3">
                                <div>
                                    <select name="trailerColor">
                                <option value="黄">黄</option>
                                <option value="黑">黑</option>
                                <option value="白">白</option>
                                <option value="蓝">蓝</option>
                                <option value="绿">绿</option>
                              </select>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="layui-col-sm4">
                    <div class="layui-form-item layui-form-item--require">
                        <label class="layui-form-label">车辆归属及所有人</label>
                        <div class="layui-input-block">
                            <div class="layui-col-sm6">
                                <div class="margin-right10">
                                    <select name="frameBelong" lay-verify="required" lay-filter="frameBelong">
                                <option></option>
                                <option value="0">自营</option>
                                <option value="1">合营</option>
                                <option value="2">合作</option>
                                <option value="3">挂靠</option>
                                <option value="4">外协</option>
                              </select>
                                </div>
                            </div>
                            <div class="layui-col-sm6">
                                <div>
                                    <select name="ownerSupplierId" lay-verify="required" lay-search lay-filter="ownerSupplierId">
                                        <option></option>
                                    </select>  
                                </div>                             
                                <input type="text" name="ownerCompanyName" id="ownerCompanyName" maxlength="255" placeholder="请输入" class="layui-input layui-hide" hc-verify="companyRegex|companySize">                            
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="layui-row">
                <div class="layui-col-sm4">
                    <div class="layui-form-item layui-form-item--require">
                        <label class="layui-form-label">车架尺寸/类型</label>
                        <div class="layui-input-block">
                            <div class="layui-col-sm6">
                                <div class="margin-right10">
                                    <select name="packSize" lay-verify="required">
                                        <option value=""></option>
                                        <option value="20">20</option>
                                        <option value="40">40</option>
                                        <option value="45">45</option>
                                        <option value="48">48</option>
                                        <option value="53">53</option>
                                    </select>
                                </div>
                            </div>
                            <div class="layui-col-sm6">
                                <select name="frameType" lay-verify="required">
                              <option value=""></option>
                            <option value="重型集装箱半挂车" selected>重型集装箱半挂车</option>
                          </select>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="layui-col-sm4">
                    <div class="layui-form-item layui-form-item--require">
                        <label class="layui-form-label">道路运输营运证号</label>
                        <div class="layui-input-block">
                            <input type="text" name="operateRoadNo" id="operateRoadNo" maxlength="20" placeholder="" class="layui-input" lay-verify="required">
                        </div>
                    </div>
                </div>
                <div class="layui-col-sm4">
                    <div class="layui-form-item ">
                        <label class="layui-form-label">危品运输营运证号</label>
                        <div class="layui-input-block">
                            <input type="text" name="operateDangerousNo" id="operateDangerousNo" maxlength="20" placeholder="" class="layui-input">
                        </div>
                    </div>
                </div>
            </div>
            <div class="layui-row">
                <div class="layui-col-sm4">
                    <div class="layui-form-item">
                        <label class="layui-form-label">车架号</label>
                        <div class="layui-input-block">
                            <input type="text" name="frameNo" id="frameNo" maxlength="18" placeholder="" class="layui-input">
                        </div>
                    </div>
                </div>
                <div class="layui-col-sm4">
                    <div class="layui-form-item">
                        <label class="layui-form-label">档案编号</label>
                        <div class="layui-input-block">
                            <input type="text" name="fileNo" id="fileNo" maxlength="20" placeholder="" class="layui-input">
                        </div>
                    </div>
                </div>
                <div class="layui-col-sm4">
                    <div class="layui-form-item">
                        <!-- <div class="layui-col-sm6"> -->
                        <label class="layui-form-label">品牌型号</label>
                        <div class="layui-input-block">
                            <div class="layui-col-sm4">
                                <div class="margin-right10">
                                    <input type="text" name="brandNo" id="brandNo" maxlength="50" placeholder="" class="layui-input">
                                </div>
                            </div>
                            <div class="layui-col-sm4">
                                <!-- <label class="layui-form-label">总质量(KG)</label> -->
                                <!-- <span style:"height:38px;line-height:38px">总质量(KG)</span> -->
                                <span style="height:38px;line-height:38px;float:right;margin-right:10px">总质量(KG)</span>
                            </div>
                            <div class="layui-col-sm4">
                                <input type="text" name="qualityTotal" id="qualityTotal" maxlength="6" placeholder="" class="layui-input" hc-verify="positiveIntegers|max" hc-verify_field="总质量" hc-verify_max="100000">
                            </div>
                        </div>
                        <!-- </div> -->
                        <!-- <div class="layui-col-sm6">
                        <label class="layui-form-label">总质量(KG)</label>
                        <div class="layui-input-block">
                            <input type="text" name="qualityTotal" id="qualityTotal" lay-verify="qualityTotal" maxlength="6" placeholder="" class="layui-input">
                        </div>
                    </div> -->
                    </div>
                </div>
            </div>
            <div class="layui-row">
                <div class="layui-col-sm4">
                    <div class="layui-form-item ">
                        <label class="layui-form-label">核定载质量(KG)</label>
                        <div class="layui-input-block">
                            <input type="text" name="qualityLoad" id="qualityLoad" lay-verify="qualityLoad" maxlength="6" placeholder="" class="layui-input"  hc-verify="positiveIntegers|max" hc-verify_field="核定载质量" hc-verify_max="100000">
                        </div>
                    </div>
                </div>
                <div class="layui-col-sm4">
                    <div class="layui-form-item ">
                        <label class="layui-form-label">整备质量(KG)</label>
                        <div class="layui-input-block">
                            <input type="text" name="qualityFullPrep" id="qualityFullPrep" lay-verify="qualityFullPrep" maxlength="6" placeholder="" class="layui-input" hc-verify="positiveIntegers|max" hc-verify_field="整备质量" hc-verify_max="100000">
                        </div>
                    </div>
                </div>
                <div class="layui-col-sm4">
                    <div class="layui-form-item ">
                        <label class="layui-form-label">外廓尺寸(长*宽*高)</label>
                        <div class="layui-input-block">
                            <div class="layui-col-sm3">
                                <!-- <div class="margin-right10"> -->
                                <input type="text" name="gabariteLength" id="gabariteLength" placeholder="长" lay-verify="gabariteLength" maxlength="6" class="layui-input" hc-verify="positiveIntegers|max" hc-verify_field="长" hc-verify_max="100000">
                                <!-- </div> -->
                            </div>
                            <div class="layui-col-sm1">
                                <div style="margin-left:7px">
                                    <span style="height:38px;line-height:38px">*</span>
                                </div>
                            </div>
                            <div class="layui-col-sm3">
                                <!-- <div class="margin-right10"> -->
                                <input type="text" name="gabariteWidth" id="gabariteWidth" placeholder="宽" lay-verify="gabariteLength" maxlength="6" class="layui-input" hc-verify="positiveIntegers|max" hc-verify_field="宽" hc-verify_max="100000">
                                <!-- </div> -->
                            </div>
                            <div class="layui-col-sm1">
                                <div style="margin-left:7px">
                                    <span style="height:38px;line-height:38px">*</span>
                                </div>
                            </div>
                            <div class="layui-col-sm3">
                                <input type="text" name="gabariteHeight" id="gabariteHeight" placeholder="高" lay-verify="gabariteLength" maxlength="6" class="layui-input" hc-verify="positiveIntegers|max" hc-verify_field="高" hc-verify_max="100000">
                            </div>
                            <div class="layui-col-sm1">
                                <span style="height:38px;line-height:38px">MM</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="layui-row">              
                <div class="layui-col-sm4">
                    <div class="layui-form-item ">
                        <label class="layui-form-label">注册日期</label>
                        <div class="layui-input-block">
                            <input type="text" name="dateReg" id="dateReg" lay-verify="dateReg" placeholder="" class="layui-input" readonly>
                        </div>
                    </div>
                </div>
                <div class="layui-col-sm4">
                    <div class="layui-form-item ">
                        <label class="layui-form-label">发证日期</label>
                        <div class="layui-input-block">
                            <input type="text" name="dateCertificate" id="dateCertificate" lay-verify="dateCertificate" placeholder="" class="layui-input" readonly>
                        </div>
                    </div>
                </div>
                <div class="layui-col-sm4">
                    <div class="layui-form-item ">
                        <label class="layui-form-label">强制报废期</label>
                        <div class="layui-input-block">
                            <input type="text" name="dateRetirement" id="dateRetirement" lay-verify="dateRetirement" placeholder="" class="layui-input" readonly>
                        </div>
                    </div>
                </div>
            </div>
            <div class="layui-row">
                <div class="layui-col-sm8">
                    <div class="layui-form-item " id="userDistrict">
                        <label class="layui-form-label">所有人地址</label>
                        <div class="layui-input-block">
                            <div class="layui-col-sm3">
                                <div class="margin-right10">
                                    <select name="userProvince" id="userProvince" lay-filter="userProvince">
                                    <option value="">请选择</option>
                                  </select>
                                </div>
                            </div>
                            <div class="layui-col-sm3">
                                <div class="margin-right10">
                                    <select name="userCity" id="userCity" lay-filter="userCity">
                                    <option value="">请选择</option>
                                  </select>
                                </div>
                            </div>
                            <div class="layui-col-sm3">
                                <div class="margin-right10">
                                    <select name="userCounty" id="userCounty" lay-filter="userCounty">
                                    <option value="">请选择</option>
                                  </select>
                                </div>
                            </div>
                            <div class="layui-col-sm3">
                                <div>
                                    <select name="userStreet" id="userStreet" lay-filter="userStreet">
                                    <option value="">请选择</option>
                                  </select>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="layui-col-sm4">
                    <div class="margin-left10">
                        <input type="text" name="ownerAddress" placeholder="请输入详细地址" class="layui-input" maxlength="255">
                    </div>
                </div>
            </div>
        </div>

        <fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;">
            <legend>其他信息</legend>
        </fieldset>
        <div class="layui-fluid">
            <div class="layui-row">
                <div class="layui-col-sm4">
                    <div class="layui-form-item ">
                        <label class="layui-form-label">车架制造商</label>
                        <div class="layui-input-block">
                            <input type="text" name="frameManufacturer" id="frameManufacturer" lay-verify="frameManufacturer" maxlength="100" placeholder="" class="layui-input">
                        </div>
                    </div>
                </div>
                <div class="layui-col-sm4">
                    <div class="layui-form-item ">
                        <label class="layui-form-label">车架颜色</label>
                        <div class="layui-input-block">
                            <input type="text" name="frameColor" id="frameColor" lay-verify="frameColor" maxlength="10" placeholder="" class="layui-input">
                        </div>
                    </div>
                </div>
                <div class="layui-col-sm4">
                    <div class="layui-form-item">
                        <div class="layui-col-sm7">
                            <label class="layui-form-label">车轴</label>
                            <div class="layui-input-block">
                                <div class="margin-right10">
                                    <select name="axleDcode">
                                  <option value=""></option>
                                  <option value="0">单轴</option>
                                  <option value="1">双轴</option>
                                  <option value="2">三轴</option>
                                </select>
                                </div>
                            </div>
                        </div>
                        <div class="layui-col-sm5">
                            <div class="margin-left10">
                                <input type="checkbox" name="midEngine" lay-skin="primary" title="中置">
                                <input type="checkbox" name="tailBoard" lay-skin="primary" title="尾板">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="layui-row">
                <div class="layui-col-sm12">
                    <div class="layui-form-item ">
                        <label class="layui-form-label">备注</label>
                        <div class="layui-input-block">
                            <textarea id="remarks" name="remarks" placeholder="0~1000字符之间" class="layui-textarea" style="min-height:50px;" maxlength="1000" hc-verify="remarkSize"></textarea>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="layui-row">
            <div class="layui-col-sm12 layui-col-lg6">
                <div class="layui-form-item">
                    <label class="layui-form-label">行驶证附件</label>
                    <div class="layui-input-block">
                        <div class="file-line"></div>
                        <div class="file-upload-button">
                            <i class="layui-icon icon-folder">&#xe7a0;</i>
                        </div>
                    </div>
                </div>
            </div>
            <div class="layui-col-sm12 layui-col-lg6">
                <div class="layui-form-item">
                    <label class="layui-form-label">营运证附件</label>
                    <div class="layui-input-block">
                        <div class="file-line"></div>
                        <div class="file-upload-button">
                            <i class="layui-icon icon-folder">&#xe7a0;</i>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="layui-row">
            <div class="layui-col-sm12 layui-col-lg6">
                <div class="layui-form-item">
                    <label class="layui-form-label">车辆登记证附件</label>
                    <div class="layui-input-block">
                        <div class="file-line"></div>
                        <div class="file-upload-button">
                            <i class="layui-icon icon-folder">&#xe7a0;</i>
                        </div>
                    </div>
                </div>
            </div>
            <div class="layui-col-sm12 layui-col-lg6">
                <div class="layui-form-item">
                    <label class="layui-form-label">协议附件</label>
                    <div class="layui-input-block">
                        <div class="file-line"></div>
                        <div class="file-upload-button">
                            <i class="layui-icon icon-folder">&#xe7a0;</i>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="layui-row">
            <div class="layui-col-sm12 layui-col-lg6">
                <div class="layui-form-item">
                    <label class="layui-form-label">其他附件</label>
                    <div class="layui-input-block">
                        <div class="file-line"></div>
                        <div class="file-upload-button">
                            <i class="layui-icon icon-folder">&#xe7a0;</i>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="insuranceInfo" style="display:none;">
            <fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;">
                <legend>保险信息</legend>
            </fieldset>
            <div class="layui-fluid">
                <div class="layui-row">
                    <div class="layui-col-sm4">
                        <div class="layui-form-item ">
                            <label class="layui-form-label">商业险保单</label>
                            <div class="layui-input-block">
                                <input type="text" name="bizWarrantyNo" placeholder="" class="layui-input">
                            </div>
                        </div>
                    </div>
                    <div class="layui-col-sm4">
                        <div class="layui-form-item ">
                            <label class="layui-form-label">交强险保单</label>
                            <div class="layui-input-block">
                                <input type="text" name="forceWarrantyNo" placeholder="" class="layui-input">
                            </div>
                        </div>
                    </div>
                    <div class="layui-col-sm4">
                        <div class="layui-form-item ">
                            <label class="layui-form-label">商业险有效期</label>
                            <div class="layui-input-block">
                                <input type="text" name="bizInsuranceE" id="bizInsuranceE" placeholder="" class="layui-input">
                            </div>
                        </div>
                    </div>
                </div>
                <div class="layui-row">
                    <div class="layui-col-sm4">
                        <div class="layui-form-item ">
                            <label class="layui-form-label">交强险有效期</label>
                            <div class="layui-input-block">
                                <input type="text" name="forceInsuranceE" id="forceInsuranceE" placeholder="" class="layui-input">
                            </div>
                        </div>
                    </div>
                    <div class="layui-col-sm4">
                        <div class="layui-form-item ">
                            <label class="layui-form-label">商业险保费</label>
                            <div class="layui-input-block">
                                <input type="text" name="bizPremium" placeholder="" class="layui-input">
                            </div>
                        </div>
                    </div>
                    <div class="layui-col-sm4">
                        <div class="layui-form-item ">
                            <label class="layui-form-label">交强险保费</label>
                            <div class="layui-input-block">
                                <input type="text" name="forcePremium" placeholder="" class="layui-input">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="layui-form-item div-add  button-bar" style="text-align:center;">
            <div class="layui-inline continue"><input type="checkbox" lay-skin="primary" id="continue" title="保存并继续新增" checked></div>
            <button class="layui-btn layui-btn-normal" lay-submit="" lay-filter="submit">保存</button>
            <button class="layui-btn layui-btn-primary btn-cancel">取消</button>
        </div>
        <div class="layui-form-item div-info" style="text-align:center; display:none;">
            <button class="layui-btn layui-btn-normal btn-modify" type="button">编辑</button>
            <button class="layui-btn layui-btn-primary btn-back" type="button">返回</button>
        </div>
        <input type="hidden" name="id">
    </form>
</body>
<script charset="utf-8" src="/view/frame/layui/layui.js"></script>
<script charset="utf-8" src="/view/frame/static/js/jquery.min.js?v=1.0"></script>
<script charset="utf-8" src="/view/tms/static/js/tms_index.js?v=1219"></script>
<script charset="utf-8" src="/view/frame/static/js/layui.district_1.js?v=1.0"></script>
<script charset="utf-8" src="/view/tms/static/js/tms_tab.js?v=1.0"></script>
<script charset="utf-8" src="/view/frame/static/js/lang_zh_CN.js?v=1.0"></script>
<!-- 工具库依赖 -->
<script charset="utf-8" src="/view/frame/static/js/errorCodeMap.js"></script>
<script charset="utf-8" src="/view/frame/static/js/HC.js?v=1.4"></script>
<script charset="utf-8" src="/view/tms/static/js/validator.js"></script>
<script charset="utf-8" src="/view/tms/static/js/bizUtil.js"></script>

<script>
    $(function() {
        layui.use(['form', 'layer', 'table', 'laydate'], function() {
            var form = layui.form,
                layer = layui.layer,
                table = layui.table,
                laydate = layui.laydate,
                tmsTab = layui.tms_tab,
                $ = layui.jquery;
            var layIdID;

            //日期
            laydate.render({
                elem: '#dateRetirement', //强制报废期
                min: 0
            });
            laydate.render({
                elem: '#dateReg', //注册日期
                max:0
            });
            laydate.render({
                elem: '#dateCertificate', //发证日期
                max:0
            });

            /****上传附件*****/
            // 初始化（绑定事件）
            $('.icon-folder').each(function () {
                HC.upload({
                    // 触发上传的元素
                    elem: $(this),
                    // 多文件上传
                    multiple: true,
                    // 允许上传的文件类型 images（默认）、file、video、audio
                    accept: 'file',
                    // 最大文件大小限制（单位kb，默认不限制）
                    size: 1024,
                }, {
                    layuiUpload: layui.upload,
                    // 指定 存放文件项的容器
                    fileItemContainer: $(this).parent().prev()
                });
            });

            $('#userDistrict').district(form);

            //车辆归属为外协车架时  营运证号为非必填和所有人的下拉框变成输入框
            var requireJudge = (function () {
                var operateRoadNoInput =  $('input[name="operateRoadNo"]');
                var operateRoadNoParent = $('input[name="operateRoadNo"]').parent().parent();
                return {
                    notReq: function() {                      
                        operateRoadNoInput.removeAttr('lay-verify');
                        operateRoadNoParent.removeClass('layui-form-item--require');

                        $('#ownerCompanyName').removeClass('layui-hide').attr('lay-verify', 'required');
                        $('select[name="ownerSupplierId"]').parent().addClass('layui-hide');
                        $('select[name="ownerSupplierId"]').removeAttr('lay-verify');
                    },
                    yesReq: function() {                                         
                        operateRoadNoInput.attr('lay-verify', 'required');
                        operateRoadNoParent.addClass('layui-form-item--require');
                        
                        $('#ownerCompanyName').addClass('layui-hide').removeAttr('lay-verify');
                        $('select[name="ownerSupplierId"]').parent().removeClass('layui-hide');
                        $('select[name="ownerSupplierId"]').attr('lay-verify');
                    },
                    getOwnerCompanyName: function() {
                       if($('#ownerCompanyName').hasClass('layui-hide')){
                           return $('select[name="ownerSupplierId"]').find('option:selected').text();
                       }  
                       return $('#ownerCompanyName').val();                      
                    },
                    getOwnerCompanyId: function() {                      
                        if($('#ownerCompanyName').hasClass('layui-hide')){
                            return $('select[name="ownerSupplierId"]').val();
                        }  

                        var osId = '';
                        $('select[name="ownerSupplierId"] option').each(function(i, d) {
                            if($('#ownerCompanyName').val() == $(this).text()){
                                osId = $(this).val();
                            }                       
                        });

                        return osId;
                    }      
                }
            })();

            form.on('select(frameBelong)', function(data) {
                if (data.value == "0" || data.value == "1" || data.value == "2" || data.value == "3") {
                    requireJudge.yesReq();  

                    $("select[name='ownerSupplierId']").empty();
                    $.get('/ucenter/userinfo.shtml', function(d) {
                        var $code = d.code,
                            $msg = d.msg,
                            $objects = d.objects;

                        if ($code == 'SUCCESS') {
                            $("select[name='ownerSupplierId']").append("<option value='" + $objects.regBodyId + "'>" + $objects.regBodyName + "</option>");
                        } else {
                            $('select[name="ownerSupplierId"]').append('<option></option>');
                        }
                        form.render('select');
                    }, 'json');
                } else {
                    requireJudge.notReq();

                    $("select[name='ownerSupplierId']").empty();
                    $.get('/ucenter/crm/supplier/supplier/showCarOwnAndTowing.shtml', function(d) {
                        var $code = d.code,
                            $msg = d.msg,
                            $objects = d.objects;
                        if ($code == 'SUCCESS') {
                            if ($objects.length > 0) {
                                for (var $i = 0; $i < $objects.length; $i++) {
                                    $('select[name="ownerSupplierId"]').append('<option value="' + $objects[$i].id + '">' + $objects[$i].nameShort + '</option>');
                                }
                            } else {
                                $('select[name="ownerSupplierId"]').append('<option></option>');
                            }
                        } else {
                            $('select[name="ownerSupplierId"]').append('<option></option>');
                        }
                        form.render('select');
                    }, 'json');
                }
            });

            //失去焦点事件
            $('#gabariteLength').blur(function() {
                var value = $(this).val();
                if (value.length > 0) {
                    if (!$jsReg.plus.test(value)) {
                        
                    } else if (value > 100000) {
                       
                    } else {
                        if (value >= 6000 && value <= 6500) {
                            $("select[name='packSize']").val(20);
                        } else if (value >= 12000 && value <= 13000) {
                            $("select[name='packSize']").val(40);
                        } else if (value >= 13100 && value <= 14000) {
                            $("select[name='packSize']").val(45);
                        } else if (value >= 14100 && value <= 15000) {
                            $("select[name='packSize']").val(48);
                        } else if (value >= 15500 && value <= 16500) {
                            $("select[name='packSize']").val(53);
                        }
                        form.render();
                    }
                }
            });

            //编辑
            var $type = $.trim(getUrlParam('type'));
            var $carColor, $carNo;
            if ($type == 'edit' || $type == 'info') {
                $(".continue").hide();
                var $id = $.trim(getUrlParam('id'));
                if ($id != null) {
                    $('input[name="id"]').val($id);

                    //获取数据
                    $.get('/ucenter/tms/capacity/carFrame/' + $id + '.shtml', function(d) {
                        var $code = d.code,
                            $msg = d.msg,
                            $objects = d.objects;
                        $carColor = $objects.carColor;
                        $carNo = $objects.carNo;


                        if ($code === 'SUCCESS') {
                            if ($objects.carNo != "") {
                                $('select[name="carShort"]').val($objects.carNo.substring(0, 1));
                                $('input[name="carNo"]').val($objects.carNo.substring(1));
                            }
                            $('select[name="trailerColor"]').val($objects.trailerColor);
                            if ($objects.trailerNo != "" && $objects.trailerNo != null) {
                                $('select[name="trailerShort"]').val($objects.trailerNo.substring(0, 1));
                                $('input[name="trailerNo"]').val($objects.trailerNo.substring(1));
                            }
                            $('select[name="carColor"]').val($objects.carColor);
                            $('select[name="frameBelong"]').val($objects.frameBelong);
                            if ($objects.frameBelong == "0" || $objects.frameBelong == "1" || $objects.frameBelong == "2" || $objects.frameBelong == "3") {
                                var $ownerSupplierId = $objects.ownerSupplierId;
                                $("select[name='ownerSupplierId']").empty();
                                $.get('/ucenter/userinfo.shtml', function(d) {
                                    var $code = d.code,
                                        $msg = d.msg,
                                        $objects = d.objects;
                                    if ($code == 'SUCCESS') {
                                        $("select[name='ownerSupplierId']").append("<option value='" + $objects.regBodyId + "'>" + $objects.regBodyName + "</option>");
                                    } else {
                                        $('select[name="ownerSupplierId"]').append('<option></option>');
                                    }
                                    form.render('select');
                                    $('select[name="ownerSupplierId"]').val($ownerSupplierId);
                                    form.render();
                                }, 'json');
                            } else {
                                requireJudge.notReq();
                                
                                var $ownerSupplierId = $objects.ownerSupplierId;
                                $("select[name='ownerSupplierId']").empty();
                                $.get('/ucenter/crm/supplier/supplier/showCarOwnAndTowing.shtml', function(d) {
                                    var $code = d.code,
                                        $msg = d.msg,
                                        $objects = d.objects;
                                    if ($code == 'SUCCESS') {
                                        if ($objects.length > 0) {
                                            for (var $i = 0; $i < $objects.length; $i++) {
                                                $('select[name="ownerSupplierId"]').append('<option value="' + $objects[$i].id + '">' + $objects[$i].nameShort + '</option>');
                                            }
                                        } else {
                                            $('select[name="ownerSupplierId"]').append('<option></option>');
                                        }
                                    } else {
                                        $('select[name="ownerSupplierId"]').append('<option></option>');
                                    }
                                    form.render('select');
                                    $('select[name="ownerSupplierId"]').val($ownerSupplierId);
                                    form.render();
                                }, 'json');

                                $('select[name="ownerSupplierId"]').val($objects.ownerSupplierId);
                            }
                            $('input[name="operateRoadNo"]').val($objects.operateRoadNo);
                            $('input[name="operateDangerousNo"]').val($objects.operateDangerousNo);
                            $('input[name="gabariteLength"]').val($objects.gabariteLength);
                            $('input[name="gabariteWidth"]').val($objects.gabariteWidth);
                            $('input[name="gabariteHeight"]').val($objects.gabariteHeight);
                            $('select[name="packSize"]').val($objects.packSize);
                            $('input[name="frameNo"]').val($objects.frameNo);
                            $('input[name="qualityTotal"]').val($objects.qualityTotal);
                            $('input[name="qualityFullPrep"]').val($objects.qualityFullPrep);
                            $('input[name="qualityLoad"]').val($objects.qualityLoad);
                            $('#userDistrict').district(form, $objects.ownerAreaId);
                            $('input[name="ownerAddress"]').val($objects.ownerAddress);
                            $('input[name="brandNo"]').val($objects.brandNo);
                            $('input[name="dateRetirement"]').val($objects.dateRetirement != null ? new Date($objects.dateRetirement).format('yyyy-MM-dd') : '');
                            $('input[name="dateReg"]').val($objects.dateReg != null ? new Date($objects.dateReg).format('yyyy-MM-dd') : '');
                            $('input[name="dateCertificate"]').val($objects.dateCertificate != null ? new Date($objects.dateCertificate).format('yyyy-MM-dd') : '');
                            $('input[name="fileNo"]').val($objects.fileNo);
                            $('select[name="frameType"]').val($objects.frameType);
                            $('input[name="frameManufacturer"]').val($objects.frameManufacturer);
                            $('input[name="frameColor"]').val($objects.frameColor);
                            $('select[name="axleDcode"]').val($objects.axleDcode);
                            if ($objects.midEngine == 1) {
                                $('input[name="midEngine"]').prop("checked", true);
                            }
                            if ($objects.tailBoard == 1) {
                                $('input[name="tailBoard"]').prop("checked", true);
                            }
                            $('textarea[name="remarks"]').val($objects.remarks);
                            $('input[name="bizWarrantyNo"]').val($objects.bizWarrantyNo);
                            $('input[name="forceWarrantyNo"]').val($objects.forceWarrantyNo);
                            $('input[name="bizInsuranceE"]').val($objects.bizInsuranceE != null ? new Date($objects.bizInsuranceE).format('yyyy-MM-dd') : '');
                            $('input[name="forceInsuranceE"]').val($objects.forceInsuranceE != null ? new Date($objects.forceInsuranceE).format('yyyy-MM-dd') : '');
                            $('input[name="bizPremium"]').val($objects.bizPremium);
                            $('input[name="forcePremium"]').val($objects.forcePremium);

                            //处理附件
                            bizUtil.data.createFileItemsByObject($('.file-line').eq(0), $objects, { fileUrlField: 'drivingAttIds', fileNameField: 'drivingAttNames' });
                            bizUtil.data.createFileItemsByObject($('.file-line').eq(1), $objects, { fileUrlField: 'operateAttIds', fileNameField: 'operateAttNames' });
                            bizUtil.data.createFileItemsByObject($('.file-line').eq(2), $objects, { fileUrlField: 'registerAttIds', fileNameField: 'registerAttNames' });
                            bizUtil.data.createFileItemsByObject($('.file-line').eq(3), $objects, { fileUrlField: 'agreementAttIds', fileNameField: 'agreementAttNames' });
                            bizUtil.data.createFileItemsByObject($('.file-line').eq(4), $objects, { fileUrlField: 'otherAttIds', fileNameField: 'otherAttNames' });

                            //公司名称
                            $('input[name="ownerCompanyName"]').val($objects.ownerCompanyName);

                            form.render();
                            if ($type == 'info') {
                                $('form select').prop('disabled', true);
                                //查看时 不允许上传
                                $('form').addClass('form--detail');
                            }
                        } else {
                            parent.layer.alert('数据异常');
                            return false;
                        }
                    }, 'json');
                }
            }

            if ($type == 'info') {
                layIdID = $('.layui-this', window.parent.document).attr('lay-id');
                $("input,textarea,select").prop("disabled", true);
                $(".div-add").hide();
                $(".div-info").show();
                $("a").css("display", "none");
                $("#insuranceInfo").show();
                form.render();
            }

            var carNoObj = {
                target: $('#carNo'),
                notice: 1,
                callBack: function(){
                    return {
                        'firstWord': $('select[name="carShort"]').val(),
                        'signVal': $('#carNo').val()
                    }
                }
            }
            var trailerNoObj = {
                target: $('#trailerNo'),
                notice: 1,
                callBack: function(){
                    return {
                        'firstWord': $('select[name="trailerShort"]').val(),
                        'signVal': $('#trailerNo').val()
                    }
                }
            }
            verifyCarNuber(carNoObj);
            verifyCarNuber(trailerNoObj);

            //监听提交
            form.on('submit(submit)', function(data) {
                carNoObj.notice = 2;
                if(!verifyCarNuber(carNoObj)){
                    return false;
                }
                trailerNoObj.notice = 2;
                if(!verifyCarNuber(trailerNoObj)){
                    return false;
                }

                if (!bizUtil.validator.verifyContainer($('form'))) {
                    return false;
                }

                var $index1 = $('#userDistrict select').not(':disabled').length - 1,
                    $ownerAreaId = $('#userDistrict select').eq($index1).val();
                var carColor = $.trim(data.field.carColor);
                var trailerNo = $.trim(data.field.trailerNo) != "" ? data.field.trailerShort + $.trim(data.field.trailerNo) : "";
                var carNo = $.trim(data.field.carNo) != "" ? data.field.carShort + $.trim(data.field.carNo) : "";
                if ($type == 'edit' || $type == 'info') {
                    if (trailerNo !== "") {
                        if (!($carColor === carColor && $carNo === carNo)) {
                            parent.layer.alert("车架车牌有更改，是否继续? ", {
                                btn: ["继续", "取消"],
                                btn1: function(index) {
                                    if ($('#userDistrict').find('select').eq(0).val() != "") {
                                        if ($ownerAreaId == "") {
                                            parent.layer.alert("所有人地址请选择完整！");
                                            return false;
                                        }
                                    }
                                    actionAjax(data, $ownerAreaId);
                                },
                                btn2: function(index) {
                                    parent.layer.close(index);
                                }
                            });
                            return false;
                        }
                    }
                }
                if ($('#userDistrict').find('select').eq(0).val() != "") {
                    if ($ownerAreaId == "") {
                        parent.layer.alert("所有人地址请选择完整！");
                        return false;
                    }
                }
                actionAjax(data, $ownerAreaId);
                return false;
            });

            function actionAjax(data, $ownerAreaId) {
                //数据源
                var $saveData = {
                    carNo: $.trim(data.field.carNo) != "" ? data.field.carShort + $.trim(data.field.carNo) : "",
                    carColor: $.trim(data.field.carColor),
                    trailerNo: $.trim(data.field.trailerNo) != "" ? data.field.trailerShort + $.trim(data.field.trailerNo) : "",
                    trailerColor: $.trim(data.field.trailerColor),
                    frameBelong: $.trim(data.field.frameBelong),
                    ownerSupplierId: $.trim(requireJudge.getOwnerCompanyId()),
                    ownerCompanyName: $.trim(requireJudge.getOwnerCompanyName()),
                    operateRoadNo: $.trim(data.field.operateRoadNo),
                    operateDangerousNo: $.trim(data.field.operateDangerousNo),
                    gabariteLength: $.trim(data.field.gabariteLength),
                    gabariteWidth: $.trim(data.field.gabariteWidth),
                    gabariteHeight: $.trim(data.field.gabariteHeight),
                    packSize: $.trim(data.field.packSize),
                    frameNo: $.trim(data.field.frameNo),
                    qualityTotal: $.trim(data.field.qualityTotal),
                    qualityFullPrep: $.trim(data.field.qualityFullPrep),
                    qualityLoad: $.trim(data.field.qualityLoad),
                    ownerAreaId: $.trim($ownerAreaId),
                    ownerAddress: $.trim(data.field.ownerAddress),
                    brandNo: $.trim(data.field.brandNo),
                    dateRetirement: $.trim(data.field.dateRetirement),
                    dateReg: $.trim(data.field.dateReg),
                    dateCertificate: $.trim(data.field.dateCertificate),
                    fileNo: $.trim(data.field.fileNo),
                    frameType: $.trim(data.field.frameType),
                    frameManufacturer: $.trim(data.field.frameManufacturer),
                    frameColor: $.trim(data.field.frameColor),
                    axleDcode: $.trim(data.field.axleDcode),
                    midEngine: $.trim(data.field.midEngine) == "" ? 0 : 1,
                    tailBoard: $.trim(data.field.tailBoard) == "" ? 0 : 1,
                    remarks: $.trim(data.field.remarks)
                }

                $.extend($saveData, 
                    bizUtil.data.getAttrDataObject($('.file-line').eq(0), { fileUrlField: 'drivingAttIds', fileNameField: 'drivingAttNames' }),
                    bizUtil.data.getAttrDataObject($('.file-line').eq(1), { fileUrlField: 'operateAttIds', fileNameField: 'operateAttNames' }),
                    bizUtil.data.getAttrDataObject($('.file-line').eq(2), { fileUrlField: 'registerAttIds', fileNameField: 'registerAttNames' }),
                    bizUtil.data.getAttrDataObject($('.file-line').eq(3), { fileUrlField: 'agreementAttIds', fileNameField: 'agreementAttNames' }),
                    bizUtil.data.getAttrDataObject($('.file-line').eq(4), { fileUrlField: 'otherAttIds', fileNameField: 'otherAttNames' })
                );

                var $url, $method;
                if ($type == 'edit') {
                    $url = '/ucenter/tms/capacity/carFrame/' + $.trim(data.field.id) + '.shtml';
                    $method = 'PUT';
                    $saveData.id = $('input[name="id"]').val();
                } else {
                    $url = '/ucenter/tms/capacity/carFrame/add.shtml';
                    $method = 'POST';
                }

                //调用接口
                HC.ajax[$method.toLowerCase()]({
                    type: $method,
                    url: $url,
                    data: JSON.stringify($saveData),
                    success: function(d) {
                        parent.layer.alert("保存成功", {
                            closeBtn: 0,
                            yes: function(index) {
                                parent.layer.close(index);
                                if ($("#continue").is(":checked")) { //保存后继续新增
                                    $(window.parent['f1'].document).find('.btn-search').click();
                                    if ($type == 'edit') {
                                        bizUtil.frame.closeCurrentIframeTab(window.parent);
                                    } else {
                                        window.location.reload();
                                    }
                                } else {
                                    $(window.parent['f1'].document).find('.btn-search').click();
                                    bizUtil.frame.closeCurrentIframeTab(window.parent);
                                }
                            }
                        });
                    }
                });
                return false;

            }

            //取消
            $(".btn-cancel").click(function() {
                bizUtil.frame.closeCurrentIframeTab(window.parent);
            });

            //修改车架
            $(".btn-modify").click(function() {
                tmsTab.add($(this), '编辑车架' + $('input[name="carNo"]').val(), "modify.html?type=edit&id=" + $('input[name="id"]').val());
                layui.tms_tab.del(layIdID);
            });

            //返回
            $(".btn-back").click(function() {
                bizUtil.frame.closeCurrentIframeTab(window.parent);
            });
        });
    });
</script>

</html>