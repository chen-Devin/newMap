<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>审核 - TMS</title>
    <link rel="stylesheet" href="/view/frame/layui/css/layui.css" media="all">
    <link rel="stylesheet" href="/view/frame/static/css/global.css?v=1.0">
    <link rel="stylesheet" href="/view/tms/static/css/add.css?v=1.0">
    <style>
        .picture {
            min-height: 85%;
            max-width: 100%;
            max-height: 85%;
            cursor: pointer;
            margin: 0 auto;
            display: block;
        }

        .img-contanier {
            margin-left: 5%;
            overflow: hidden;
            height: 230px;
            border: 1px solid #ddd;
        }

        .img-contanier label {
            width: 95% !important;
            text-align: center;
        }

        .layui-layer-dialog {
            width: auto !important;
            max-width: 100%;
            overflow-x: auto;
        }

        .layui-layer-dialog img {
            max-width: 100%;
        }
    </style>
</head>

<body>
    <form class="layui-form" method="post" autocomplete="off">
        <fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;">
            <legend>基本信息</legend>
        </fieldset>

        <div class="layui-fluid">
            <div class="layui-row">
                <div class="layui-col-sm4">
                    <div class="layui-form-item">
                        <label class="layui-form-label">司机姓名</label>
                        <div class="layui-input-block">
                            <input type="text" name="name" placeholder="" class="layui-input" disabled>
                        </div>
                    </div>
                </div>
                <div class="layui-col-sm4">
                    <div class="layui-form-item">
                        <label class="layui-form-label">手机号码</label>
                        <div class="layui-input-block">
                            <input type="text" name="mobile" placeholder="" class="layui-input" disabled>
                        </div>
                    </div>
                </div>
                <div class="layui-col-sm4">
                    <div class="layui-form-item">
                        <label class="layui-form-label">身份证号</label>
                        <div class="layui-input-block">
                            <input type="text" name="idNo" placeholder="" class="layui-input" disabled>
                        </div>
                    </div>
                </div>
            </div>
            <div class="layui-row">
                <div class="layui-col-sm4">
                    <div class="layui-form-item">
                        <div class="img-contanier photo">
                            <img class="picture" />
                            <label class="layui-form-label">上身照片</label>
                        </div>
                    </div>
                </div>
                <div class="layui-col-sm4">
                    <div class="layui-form-item">
                        <div class="img-contanier idImg">
                            <img class="picture" />
                            <label class="layui-form-label">身份证正面照片</label>
                        </div>
                    </div>
                </div>
                <div class="layui-col-sm4">
                    <div class="layui-form-item">
                        <div class="img-contanier idImg">
                            <img class="picture" />
                            <label class="layui-form-label">身份证背面照片</label>
                        </div>
                    </div>
                </div>
            </div>
            <div class="layui-row">
                <div class="layui-col-sm4">
                    <div class="layui-form-item">
                        <div class="img-contanier driversLicenseImg">
                            <img class="picture" />
                            <label class="layui-form-label">驾驶证照片</label>
                        </div>
                    </div>
                </div>
                <div class="layui-col-sm4">
                    <div class="layui-form-item">
                        <div class="img-contanier currentLicenseImg">
                            <img class="picture" />
                            <label class="layui-form-label">行驶证照片</label>
                        </div>
                    </div>
                </div>
                <div class="layui-col-sm4">
                    <div class="layui-form-item">
                        <div class="img-contanier carInsuranceImg">
                            <img class="picture" />
                            <label class="layui-form-label">车辆保单照片</label>
                        </div>
                    </div>
                </div>
            </div>
            <div class="layui-row">
                <div class="layui-col-sm4">
                    <div class="layui-form-item">
                        <div class="img-contanier operateRoadImg">
                            <img class="picture" />
                            <label class="layui-form-label">营运证照片</label>
                        </div>
                    </div>
                </div>
                <div class="layui-col-sm4">
                    <div class="layui-form-item">
                        <div class="img-contanier jobQualImg">
                            <img class="picture" />
                            <label class="layui-form-label">从业资格证照片</label>
                        </div>
                    </div>
                </div>
            </div>
            <div class="layui-row auditRemarks" style="display: none">
                <div class="layui-col-sm12">
                    <div class="layui-form-item">
                        <label class="layui-form-label">审核不通过原因</label>
                        <div class="layui-input-block">
                            <textarea name="auditRemarks" placeholder="审核不通过时必填(0~1000字符之间)" class="layui-textarea" style="min-height:50px;" maxlength="1000"
                                hc-verify="remarkSize"></textarea>
                        </div>
                    </div>
                </div>
            </div>
            <div id="buttonBar" class="layui-form-item button-bar" style="display: none">
                <button type="button" class="layui-btn layui-btn-normal" lay-submit lay-filter="submit" data-status="6">审核通过</button>
                <button type="button" class="layui-btn layui-btn-danger" lay-submit lay-filter="submit" data-status="5">审核不通过</button>
            </div>
        </div>
    </form>
</body>
<script charset="utf-8" src="/view/frame/layui/layui.js"></script>
<script charset="utf-8" src="/view/frame/static/js/jquery.min.js?v=1.0"></script>
<script charset="utf-8" src="/view/tms/static/js/tms_index.js?v=1219"></script>

<script charset="utf-8" src="/view/frame/static/js/errorCodeMap.js"></script>
<script charset="utf-8" src="/view/frame/static/js/HC.js?v=1.4"></script>
<script charset="utf-8" src="/view/tms/static/js/validator.js"></script>
<script charset="utf-8" src="/view/tms/static/js/bizUtil.js"></script>

<script>
    layui.use(['form', 'layer', 'tms_tab'], function () {
        var form = layui.form,
            layer = layui.layer,
            tmsTab = layui.tms_tab,
            $ = layui.jquery;

        var $type = $.trim(getUrlParam('do'));
        var $idS = $.trim(getUrlParam('id'));

        if ($type === 'edit') {
            $('#buttonBar').show();
            $('.auditRemarks').show();
        }

        function setImg(target, imgId, title) {
            var imgArr = (imgId || '').split(',');
            if (target === '.idImg') {
                setImg($(target).eq(0), imgArr[0], '身份证正面照片');
                if (imgArr.length > 1) {
                    setImg($(target).eq(1), imgArr[1], '身份证反面照片');
                }

            } else {
                $(target).html('<img class="picture" src="/ucenter/download/' + imgArr[0] +
                    '.shtml" alt="' + imgArr[0] + '"><label class="layui-form-label">' + title + '</label>');
            }

        }

        //获取信息
        HC.ajax.get({
            url: '/ucenter/tms/capacity/driver/getAuditInfo.shtml',
            data: {
                id: $idS
            },
            success: function (data) {
                $('input[name="name"]').val(data.name);
                $('input[name="mobile"]').val(data.mobile);
                $('input[name="idNo"]').val(data.idNo);

                var imgContanier = ['.photo', '.idImg', '.driversLicenseImg', '.currentLicenseImg', '.carInsuranceImg', '.operateRoadImg', '.jobQualImg'];
                var imgTitle = ['上身照片', '身份证照片', '驾驶证照片', '行驶证照片', '车辆保单照片', '营运证照片', '从业资格证照片'];
                $.each(imgContanier, function (i, d) {
                    setImg(d, data[d.substring(1)], imgTitle[i]);
                });

                $('.picture').click(function () {
                    var imgId = $(this).attr('alt');
                    if (imgId) {
                        layer.alert('<img src="/ucenter/download/' + imgId + '.shtml" alt="' + imgId + '">', {
                            title: '查看大图',
                            shadeClose: true
                        });
                    }
                });
            }
        });

        //监听提交
        form.on('submit(submit)', function (data) {
            var status = Number($(this).data('status'));
            var auditRemarks = $.trim(data.field.auditRemarks);
            if (status === 5 && auditRemarks.length === 0) {
                $('textarea[name="auditRemarks"]').focus();
                layer.msg('审核不通过时需要填写原因！');
                return false;
            }
            var saveData = {
                id: $idS,
                status: Number($(this).data('status')),
                auditRemarks: data.field.auditRemarks
            };

            HC.ajax.post({
                url: '/ucenter/tms/capacity/driver/audit.shtml',
                data: saveData,
                success: function (data) {
                    parent.layer.alert('审核成功！', {
                        yes: function (index) {
                            parent.layer.closeAll();
                            //获取当前框架ID并刷新
                            bizUtil.frame.refreshCurrentFrame();
                            bizUtil.frame.refreshListFrame();
                            bizUtil.frame.closeCurrentIframeTab(window.parent);
                        }
                    });
                }
            });

            return false;
        });
    });
</script>

</html>